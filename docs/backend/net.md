# 计算机网络

## 参考  
[《计算机网络-自顶向下方法》笔记](https://juejin.cn/post/7076455229377478692#heading-11)  
[计算机网络（自顶向下方法）学习笔记](https://blog.csdn.net/qq_39326472/article/details/88089747)
## 专用名词简写
ISP:Internet Service Provider:因特网服务提供商  
TCP（Transport Control Protocol，传输控制协议）和IP(Internet Protocol，网际协议)  
应用程序编程接口（API)  

- DSL(Digital Subscribe Line)数字用户线
- CIC(Cable Internet Access)电缆因特网接入
- 混合光纤同轴（Hybrid Fiber Coax HFC）


数字用户线接入复用器（DSLAM）

## 第一章
==> 计算机网络边缘与核心  
==> 数据的延时、丢包、和吞吐量  
==> 体系结构原则  
==> 网络安全  
==> 历史  

### 1.1 什么是因特网
1. 构成： **端系统**通过**通信链路和分组交换机**连接到一起.
2. 功能:
   协议：定义了两个或多个通信实体（不一定是端系统，还有可能是分组交换机等）之间交换信息的格式和次序以及对该信息所采取的动作。

### 1.2 网络边缘  
端系统：与因特网相连的计算机和其它设备，往往处于网络的边缘  
端系统分类：客户和服务器  

#### 1.2.1 接入网
接入网：是指将端系统连入到边缘路由器的物理链路  
边缘路由器：是指端系统到任何其他远程端系统路径上的第一台路由器  

- DSL(Digital Subscribe Line)数字用户线
    宽带住宅接入的方法，ISP是本地电话公司，通信链路的物理材质:电话线(**双绞线**)。

用户使用**DSL调制解调器**通过电话线与ISP中的**数字用户线接入复用器**（DSLAM）来交换数据；家庭DSL调制解调器将数字数据转换为高频音后通过电话线传输到ISP中心，并且通过DSL解调器将DSLAM发送过来的模拟信号转为数字信号；

- CIC(Cable Internet Access)电缆因特网接入
    宽带住宅接入方法，ISP是有线电视公司，通信链路的物理材质有**光纤和同轴电缆**，也被称为**混合光纤同轴**（Hybrid Fiber Coax HFC）；

用户使用电缆调制解调器通过同轴电缆与光纤结点相连，光纤结点通过光缆与电缆头端相连，而电缆头端接入了因特网。在电缆头端，**电缆调制解调器端接系统**（Cable Modem Termination System）起到DSLAM的作用，即实现模拟信号和数字信号的转换；

- FTTH(Fiber TO The Home)光纤到户
    光纤作为通信链路的材质，有两种竞争性的光纤分布方案：主动光纤网络（Active Optical Network），被动光纤网络(Passive Optical Network).其主要区别在于，是否在传输数据时共享光纤。

- 以太网和WIFI
    以太网接入是一种在公司、大学、家庭里很流行的接入方式；用户使用**双绞线与以太网交换机**相连，从而接入因特网；接入以太网交换机的速度可达100Mbps;

在无线局域网中，无线用户从一个接入点发送和接收数据，而该接入点与企业网相连，企业网最终接入因特网；在无线LAN中，用户需要在一个接入点的几十米范围之内；

- 广域无线接入
    在移动设备中，通过蜂窝网提供商运营的**基站**来发送和接收分组，与WIFI不同的是，用户仅需要位于基站的数万米范围之内即可；

#### 1.2.2 物理媒体

传输媒体是构成通信链路的主要部分，物理媒体通常可以分为导引性媒体和非导引性媒体；其中导引性媒体，信号沿着固体前行；而非导引性媒体中，信号沿着非固体媒体前行

值得注意的是，架设传输媒体的人历成本要远远高于物理材料的成本

- 双绞线
    最便宜的引导性传输媒体，由两条**相互螺旋缠绕的铜线**组成。目前局域网中的双绞线数据传输速率在==10Mbps到10Gbps==之间，所能达到的数据传输速率取决于线的粗细以及传输距离；双绞线实际上已经成为高速局域网联网的主要方式；因为现代的双绞线技术速率和传输距离都是很不错的；

- 同轴电缆
    也由**两个铜导体**构成，但是它们是**同心**的，而非并行的；借助特殊的结构和绝缘层，同轴电缆可得到较高的数据传输速率；在电视系统中应用广泛；同轴电缆可被用作引导性的共享媒体；

- 光纤
    一种可以引导光脉冲的媒体

- 陆地无线电信道
    无线电信道承载电磁频谱中的信号，不需要物理线路，提供与移动用户的连接以及长距离承载信号的方式；是一种有吸引力的媒体；

- 卫星无线电信道
    通过卫星连接两个或多个在地球上的微波发射方（也被称为地面站），该卫星在一个频段上接收信号，在另一个频段上发送信号；种类有同步卫星和近地轨道卫星；

### 1.3 网络核心

网络核心即为由互联端系统的**分组交换机和链路**构成的网状网络

通过网络链路和交换机移动数据有两种基本方法：电路交换和分组交换

#### 1.3.1 分组交换
分组在通信链路上以等于该链路的**最大传输速率**传输通过通信链路。

因此如果某条链路的最大传输速率为R，分组长度为L，则该链路传输该分组的时间为==L/R==；这个时间也被称为传输时延；

常见方式：存储转发

- 存储转发
    大多数分组交换机采用存储转发机制来转发分组；所谓存储转发是指交换机在收到一个完成的分组，才会向链路输出转发分组，否则就将收到的部分分组缓存起来；因为缓存等待一个分组的全部数据而导致的时间开销被称为**存储转发时延**
- 排队时延与分组丢失
	因为需要缓存分组，所以此时分组交换机需要一个缓冲队列；缓冲队列的空间有限性就有可能导致分组交换机无法继续缓存分组（因为链路被占用或者分组还没全部到位）而使到达分组交换机的**数据包被迫丢弃**；这就导致了分组不但承担了传输时延，还承担了队列时延。

- 转发表与路由选择协议
	分组交换机之所以能够知道往哪去是因为其内部有一个**转发表**，这个表维护了一个IP地址和链路的对应关系，所以处理流程为：
	1. 通过分组的必要信息，**获得目的端系统的IP地址**
	2. 通过IP地址**索引转发表**，从而确定输出链路

#### 1.3.2 电路交换
在电路交换网络中，在端系统通信会话期间，交换机会预留端系统间通信路径上的相关资源（缓存，链路传输速率），即**先建立连接，然后通信**；线路**独享**。而这一连接，用电话的术语被称为“电路”。传统的电话网络就是电路交换网络的例子。

- 电路交换网络中的复用
    时分复用（Time-Division Multiplexing TDM）：是指将时间划分为固定区间的帧，每个帧则又被划分为固定数量的时间空隙；当网络需要建立一条连接时，网络将在每个帧中为该连接指定一个时隙；在该时隙内，链路用来传输该链接的数据；

    频分复用(Frequency-Division Multiplexing)：将频率域划分为频段，然后将频段分配给连接；此频段被用来专门传输链接的数据。该频段的宽度成为带宽。

#### 1.3.3 分组交换和电路交换的对比
- 分组交换

    优点：
    	它提供了比电路交换更好的**带宽共享**；
    	它比电路交换更简单、更有效、实现成本更低；

    缺点：
    	分组交换**不适合实时服务**，因为端到端的时延是可变、不可预测的，这和整个网络的情况相关；

- 电路交换

    优点：
    	提供了端对端传输数据的速率保证；

    缺点：
    	电路交换存在静默期，这是指专用电路空闲时，其占用的**资源并没有得到充分**的利用；
    	建立连接的过程比较复杂；

总体上来说，分组交换的性能要好于电路交换的性能，但是不同类型的分组交换方式有不同的应用场景；比如一些对最低速率有着严格要求的应用，比如实时服务等，为了获得速率保证，牺牲网络的效率也是可以接受的。趋势向着分组交换发展。

#### 1.3.4 网络的网络
描述：**因特网是网络的网络**。书中通过5个模型不断过渡到最终模型，其实过渡的过程就结构不断合理、连接方式不断明确的过程。

我们在什么是因特网 一节中介绍ISP，端系统是通过ISP接入因特网的，为了实现端系统的互联，ISP也必须互联，其实**网络模型就是用来表达ISP和端系统以及ISP之间的结构**的抽象；

网络结构1：存在**唯一的全球承载ISP**互联所有的接入ISP，这是指，全球ISP是一个又路由器和通信链路构成的网络，该网络跨越全球，并且其他的接入ISP都至少和一个它的路由器相连；

网络结构2：存在**多个全球承载ISP**，它们分别于一部分的接入ISP互联；为了实现端系统的互联，这多个全球ISP也必须互联；网络结构是一个两层结构，其中全球承载ISP位于顶层，接入ISP处于底层；

网络结构3：顶层全球承载ISP基本上已经定型，但是接入ISP现在还很混乱，比如，它们直接同顶层ISP相连；而网络结构3中，接入ISP也是分层的：**较小区域中的ISP连入较大区域的ISP，而不是直接与顶层ISP相连**；(为什么会出现这样的结构呢？这是因为，如果都直接同顶层ISP相连，那么两个同一较小区域内，分属不同ISP的端系统之间通信的数据也会到顶层ISP中心去一趟，如果它们不是直接接入顶层ISP，而是接入了一个较大区域的ISP，那么它们之间的通信数据就不用去顶层ISP中心了，因为它们通过较大区域的ISP已经实现了互连，所以通信速度肯定就上去了。)

网络结构4：是在网络结构3的基础上，增加了以下**特点而形成的结构**：存在点（Point of Presence，PoP）==?==、多宿、对等、因特网交换点（Internet exchange point，IXP）。

PoP存在于等级结构中所有层次，但是底层ISP除外；一个PoP是ISP网络中的一台或者多台路由器群组，其中客户ISP能够通过第三方提供的高速链路直接将它的路由器和供应商的PoP连接，从而实现与提供商ISP连接。这样接入速度很明显就提高了。
多宿（multi-home）是指，任何ISP（除第一层ISP）都可以与两个或者多个提供商ISP连接，这被称为多宿；这样网络的可靠性就提高了
对等（peer） 是指，位于**相同等级结构层次**的一对**邻近ISP**能够**直接**将它们的网络**连接到一起**，使它们之间流量经直接连接而不是经过上游的中间ISP传输，这样既不用付费，速度也可能会快一些；
因特网交换点: 是为了**实现多个ISP可以对等**而创建的。

网络结构5：网络结构5是在网络结构4的基础上**增加了内容提供商网络**而构成。内容提供商构建自己的网络，并且通过与较低层ISP对等而“绕过”较高层因特网ISP，而且内容提供商对端用户也有了更多的控制。

总体来说，今天的因特网是一个“网络的网络”，其结构复杂，由**十多个顶层ISP和数十万个较低层ISP构成**。近年来，主要的内容提供商创建自己的网络，直接在可能的地方与较低层ISP互联

1.4 分组交换中的时延、丢包、吞吐量
因特网能够看成是一种运行在端系统上的**分布式应用提供服务**的基础设施  
计算机网络必定要要限制在端系统之间的吞吐量，故在端系统之间存在时延、丢包；

1.4.1 分组交换网中的时延概述
一个分组在沿途每个节点承受不同类型的时延，这些时延中最为重要的是：结点处理时延、排队时延、传输时延和传播时延.这些时延总体累加起来是**结点总时延**

时延的类型

**处理时延**
处理时延是因为==节点需要解析分组的必要信息然后决定其出链路==（索引转发表等操作）而产生的，通常在==微秒==或者更低数量级；

**排队时延**
排队时延是因为==分组所对应的出链路前面有其他分组正在传输==，所以分组需要该链路的缓冲队列里等待其他分组传输完毕而产生的；一般来说，排队时延是到达该队列的==流量强度和性质的函数==，通常可以达到==毫秒级到微秒==级；

**传输时延**
传输时延是==将所有分组的比特推向链路==所有需要的时间，实际的传输时延通常在==毫秒到微秒==数量级。用L表示分组的长度，用Rbps表示从路由器A到B的链路传输速率。传输时延是==L/R==。

**传播时延**
传播时延是指==比特进入链路后==，从该链路的起点到下一个结点所用的时间；一旦分组中的最后一个比特到达路由器就意味着该分组的所有比特都已到达路由器；广域网中，传播时延一般是==毫秒级==的。传播时延是==d/s==。d是路由器A到B的距离。s是链路的传播速率。

传输时延和传播时延的对比

如果打个比方的话，传输时延就是大卡车经过收费站的时间而传播时间就是车在高速公路上行驶的时间。传输时延是分组长度和链路传输速率的函数。传播时延是两台路由器间距离的函数

1.4.2 排队时延和丢包
丢包：到达的分组发现一个满的队列。==由于没有地方存储这个分组==，路由器将丢弃该分组，该分组将会丢失

排队时延和丢包与网络的状况和结点的==缓冲空间大小、处理速度相关==；如果分组到达的速度高于结点的处理速度，那么分组就会在缓冲队列里排队等待。当缓冲空间用完后，如果还有到的分组，那么该分组将被迫丢弃

为了描述网络状体，我们引入了流量强度这一概念：==流量强度=分组到达的速度/结点的处理速度==；流量工程里一个金科玉律就是：设计系统时流量强度不能大于1；

==当流量强度持续大于1时，就将出现丢包现象==

1.4.3 端到端时延

![d_{end-end}=N(d_{proc}+d_{trans}+d_{prop})](gif.latex)

1.4.4 计算机网络的吞吐量
计算机网络的吞吐量实际上是一个==速度指标==，它描述了==比特经过某个节点的速度==。对于某条路径上的结点来说，和该结点有关的速度有两个：==接收数据的速度和发送数据的速度==，而该结点的吞吐量是这==两个速度中较小的一个==；对于某条路径来说，该路径的吞吐量则是==所有节点的吞吐量的最小值==；网络的吞吐量可以衡量网络的性能.

任何时间的==瞬时吞吐量==是主机B接受到该文件的速率

如果该文件由F比特组成，主机B接受到所有比特用去Ts，则文件的==平均吞吐量为F/Tbps==

吞吐量可以近似为源和目的地之间路径的最小传输速率。==最小传输速率的链路为瓶颈链路==。

在今天，因特网对吞吐率的限制因素==通常是接入网==。

1.5 协议层次及其服务模型
因特网是一个极为复杂的系统，该系统里存在着大量的应用程序和协议、各种类型的端系统、分组交换机和各种类型的链路级媒体。但是它同时也是有着清晰结构的，就像我们前面在网络核心 一节介绍的，我们仍能构建它的结构模型

1.5.1 分层体系结构
计算机网络采用分层的体系结构，分层的体系结构因为提供模块化而具有很高的价值，同时也易于服务实现的多样性：某一层对其上一层提供服务，同时它可以利用下一层提供的服务。==只要对上提供的服务和对下利用的服务没有变化，其层内部的实现并不会对系统结构产生影响==；对于大而复杂且需要不断更新的系统来说，改变服务的实现而不影响系统其他组件是分层模式的另一个重要优点

为了给网络协议的设计提供一个结构，网络设计者以分层的方式组织协议以及实现这些协议的软硬件

一个协议层可以使用软硬件实现，同时某个协议层的不同部分常常位于网络组件的各部分。协议分层具有概念化和结构化的优点。模块化使得更新系统组件更为容易。但是分层也有其缺点，就是功能上的冗余，比如许多协议栈针对链路和端到端两种情况都提供了差错恢复功能。第二种潜在的缺点就是某层的功能可能需要仅在其它层才出现的信息

总体来说，将各层的所有协议组合起来，称为==协议栈==。因特网的协议栈有5个层次组成：==物理层==、==链路层==、==网络成==、==传输层==、==应用层==

- 应用层：应用层协议分布在多个端系统，端系统中的应用程序使用该协议与另一个端系统中的应用程序通信。处于应用层的分组称为==报文==；
- 传输层：传输层在应用程序端点之间传输应用层报文，因特网中有两个传输层协议：==TCP和UDP==。处于传输层的分组称为==报文段==。TCP提供确保传递、流量控制、拥塞控制机制。UDP提供无连接服务，即不提供不必要服务的服务，没有可靠性、没有流量和拥塞控制。
- 网络层：网络层将称为==数据报==的网络层分组从一台主机移动到另一台主机。网络层协议包含著名的==IP协议以及其他一些路由选择协议==。
- 链路层：链路层将称为==帧==的链路层分组从一个结点移动到路径上的另一个端点。一个帧可能被沿途不同链路上的不同链路层协议处理。
- 物理层：物理层的任务是将帧中的==比特==从一个结点移动到下一个节点，它提供了传输信息的实际物理通道；

OSI模型
在因特网协议栈出现以前，OSI模型是ISO组织研发的计算机网络结构模型。OSI的模型一共有7层，从下到上依次为：物理层，链路层，网络层，传输层，会话层，表示层，应用层。相比因特网体系结构，OSI多了两层。

因特网将两层的功能留给了开发者自行实现。

1.5.2 封装
一个分组，在不同的层次有不同的称谓，是因为它们经过每一层的时候就被该层封装上了属于该层的相关信息，也就是前面提到的必要信息；于是，每一分层的分组有两种类型的字段：==首部字段和有效负载==；其中有效负载即为来自上一层的分组数据，而首部字段就是该层加上的必要信息；分组不断被封装以实现各层协议规定的相关功能

